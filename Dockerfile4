# ---- Stage 1: Build tmux using CentOS Stream 9 ----
FROM almalinux:9 AS builder

RUN dnf install -y gcc make bison ncurses ncurses-devel libevent-devel wget \
    tar && \
    wget https://github.com/tmux/tmux/releases/download/3.4/tmux-3.4.tar.gz && \
    tar -xzf tmux-3.4.tar.gz && \
    cd tmux-3.4 && \
    ./configure && \
    make && \
    make install && \
    infocmp tmux > /tmux.terminfo

FROM registry.access.redhat.com/ubi9/ubi:9.5-1742918310

COPY --from=builder /usr/local/bin/tmux /usr/local/bin/tmux
COPY --from=builder /tmux.terminfo /tmp/tmux.terminfo

RUN dnf install -y ncurses ncurses-base libevent
RUN tic -x /tmp/tmux.terminfo

ENV TERM=xterm-256color

# Optional: install Python
RUN dnf install -y python39 python3-pip && dnf clean all

# Copy your scripts
RUN mkdir -p /opt/aes/
COPY *.sh /opt/aes/
COPY *.py /opt/aes/
RUN chmod +x /opt/aes/*.sh
RUN chmod +x /opt/aes/*.py

ENTRYPOINT ["/opt/aes/entrypoint.sh"]
